<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Client-side CAPTCHA (HTML + JS)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial; padding: 2rem; color: #111; }
    .container { max-width: 540px; margin: 0 auto; }
    .captcha-box { display:flex; gap:1rem; align-items:center; }
    canvas { background: #f6f7fb; border: 1px solid #ddd; border-radius: 4px; }
    .controls { display:flex; flex-direction:column; gap:.5rem; }
    input[type="text"] { padding:.5rem; font-size:1rem; width: 100%; box-sizing:border-box; }
    button { padding:.5rem 0.75rem; font-size:1rem; cursor:pointer; }
    .msg { margin-top:.75rem; font-weight:600; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Client-side CAPTCHA demo</h1>
    <p>Type the distorted text you see in the image. This demo runs completely in your browser.</p>

    <div class="captcha-box">
      <canvas id="captchaCanvas" width="260" height="90" aria-label="captcha image"></canvas>

      <div class="controls" style="flex:1;">
        <label for="answer">Enter text</label>
        <input id="answer" type="text" autocomplete="off" inputmode="latin" />
        <div style="display:flex; gap:.5rem;">
          <button id="verifyBtn">Verify</button>
          <button id="refreshBtn" type="button">Refresh</button>
        </div>
        <div id="result" class="msg" role="status" aria-live="polite"></div>
      </div>
    </div>
  </div>

  <script>
  (function () {
    // Config
    const CHARS = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; // avoid ambiguous chars
    const LENGTH = 6;

    const canvas = document.getElementById('captchaCanvas');
    const ctx = canvas.getContext('2d');
    const answerInput = document.getElementById('answer');
    const verifyBtn = document.getElementById('verifyBtn');
    const refreshBtn = document.getElementById('refreshBtn');
    const resultDiv = document.getElementById('result');

    let currentText = '';

    // Utility: random integer in [min, max]
    function randInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }
    function randChoice(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }
    function randomText(len) {
      let s = '';
      for (let i = 0; i < len; i++) s += CHARS.charAt(Math.floor(Math.random() * CHARS.length));
      return s;
    }

    // Draw one CAPTCHA
    function drawCaptcha(text) {
      const W = canvas.width, H = canvas.height;
      // clear
      ctx.clearRect(0, 0, W, H);

      // background gradient
      const g = ctx.createLinearGradient(0,0,W,H);
      g.addColorStop(0, '#fbfcfe');
      g.addColorStop(1, '#f0f4ff');
      ctx.fillStyle = g;
      ctx.fillRect(0, 0, W, H);

      // subtle background pattern (noise dots)
      for (let i = 0; i < 120; i++) {
        ctx.fillStyle = `rgba(${randInt(180,230)},${randInt(180,230)},${randInt(200,245)},${Math.random()*0.25})`;
        ctx.beginPath();
        const x = Math.random()*W, y = Math.random()*H;
        ctx.arc(x, y, Math.random()*1.6, 0, Math.PI*2);
        ctx.fill();
      }

      // Draw each character individually with random transform
      const padding = 12;
      const availableW = W - padding*2;
      // measure rough per-char width
      let x = padding;
      const avgCharWidth = availableW / text.length;

      for (let i = 0; i < text.length; i++) {
        const ch = text[i];

        // random font size and style
        const fontSize = randInt(30, 44);
        const fonts = ['Arial','Verdana','Helvetica','Georgia','Tahoma','Times New Roman'];
        ctx.font = `${fontSize}px ${randChoice(fonts)}`;

        // create an offscreen canvas for the character to apply rotations/scales easily
        const oc = document.createElement('canvas');
        const octx = oc.getContext('2d');
        // give enough room for rotation
        oc.width = Math.ceil(avgCharWidth * 1.8);
        oc.height = Math.ceil(fontSize * 2.2);

        // random color
        const colors = ['#20303f','#2b2b3a','#1b3a2a','#232a44'];
        octx.fillStyle = randChoice(colors);
        octx.textBaseline = 'middle';
        octx.textAlign = 'center';
        octx.font = `${fontSize}px ${randChoice(fonts)}`;

        // slight shadow
        octx.shadowColor = 'rgba(0,0,0,0.25)';
        octx.shadowBlur = 2;
        octx.shadowOffsetX = 1;
        octx.shadowOffsetY = 1;

        // draw char in center
        octx.fillText(ch, oc.width/2, oc.height/2 + 4);

        // random rotation and scale
        const angle = (Math.random() * 60 - 30) * Math.PI / 180;
        const sx = 0.9 + Math.random() * 0.3;
        const sy = 0.85 + Math.random() * 0.3;

        // place on main canvas
        const y = H/2 + randInt(-6, 6);
        ctx.save();
        const cx = x + avgCharWidth/2 + randInt(-6, 6);
        ctx.translate(cx, y);
        ctx.rotate(angle);
        ctx.scale(sx, sy);
        // Slight shear
        const shear = (Math.random() * 0.4 - 0.2);
        ctx.transform(1, shear, 0, 1, 0, 0);

        // draw the offscreen char centered at (0,0)
        ctx.drawImage(oc, -oc.width/2, -oc.height/2);
        ctx.restore();

        x += avgCharWidth;
      }

      // Draw random interference curves
      for (let i = 0; i < randInt(3,6); i++) {
        ctx.beginPath();
        ctx.lineWidth = 1 + Math.random()*2;
        ctx.strokeStyle = `rgba(${randInt(20,70)},${randInt(20,80)},${randInt(20,80)},${0.35 + Math.random()*0.4})`;
        const startY = randInt(10, H-10);
        ctx.moveTo(0, startY);
        // draw a bezier-like curve across canvas
        const cp1x = randInt(W*0.1, W*0.4), cp1y = randInt(-20, H+20);
        const cp2x = randInt(W*0.6, W*0.9), cp2y = randInt(-20, H+20);
        ctx.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, W, randInt(10, H-10));
        ctx.stroke();
      }

      // random dots/noise on top
      for (let i = 0; i < 180; i++) {
        ctx.fillStyle = `rgba(${randInt(0,120)},${randInt(0,120)},${randInt(0,120)},${Math.random()*0.35})`;
        ctx.beginPath();
        ctx.arc(Math.random()*W, Math.random()*H, Math.random()*1.4, 0, Math.PI*2);
        ctx.fill();
      }

      // final pixel-warp to make OCR harder
      pixelWarp(canvas, { amplitude: randInt(4,8), period: randInt(60,120) });
    }

    // pixelWarp: shift each column by a sine-based offset
    function pixelWarp(srcCanvas, opts = {}) {
      const amplitude = opts.amplitude || 6;
      const period = opts.period || 80;
      const phase = Math.random() * Math.PI * 2;

      const w = srcCanvas.width, h = srcCanvas.height;
      const sctx = srcCanvas.getContext('2d');
      const src = sctx.getImageData(0,0,w,h);
      const dst = sctx.createImageData(w,h);

      for (let x = 0; x < w; x++) {
        const offset = Math.floor(amplitude * Math.sin((x/period) * Math.PI*2 + phase));
        for (let y = 0; y < h; y++) {
          const srcY = y + offset;
          if (srcY < 0 || srcY >= h) {
            // background pixel
            const di = (y*w + x) * 4;
            dst.data[di] = 250; dst.data[di+1] = 250; dst.data[di+2] = 250; dst.data[di+3] = 255;
          } else {
            const si = (srcY*w + x) * 4;
            const di = (y*w + x) * 4;
            dst.data[di]   = src.data[si];
            dst.data[di+1] = src.data[si+1];
            dst.data[di+2] = src.data[si+2];
            dst.data[di+3] = src.data[si+3];
          }
        }
      }
      sctx.putImageData(dst, 0, 0);
    }

    // create a new captcha and draw it
    function refreshCaptcha() {
      currentText = randomText(LENGTH);
      answerInput.value = '';
      resultDiv.textContent = '';
      drawCaptcha(currentText);
    }

    verifyBtn.addEventListener('click', function (e) {
      e.preventDefault();
      const val = (answerInput.value || '').trim();
      if (!val) {
        resultDiv.style.color = '#b33';
        resultDiv.textContent = 'Please type the text shown.';
        return;
      }
      if (val.toLowerCase() === currentText.toLowerCase()) {
        resultDiv.style.color = '#0a0';
        resultDiv.textContent = 'Success — CAPTCHA matched.';
      } else {
        resultDiv.style.color = '#b33';
        resultDiv.textContent = 'Incorrect — please try again.';
      }
    });

    refreshBtn.addEventListener('click', function (e) {
      e.preventDefault();
      refreshCaptcha();
    });

    // allow Enter key inside input to verify
    answerInput.addEventListener('keydown', function (ev) {
      if (ev.key === 'Enter') {
        ev.preventDefault();
        verifyBtn.click();
      }
    });

    // initial draw
    refreshCaptcha();

    // expose a helper if you want to get the expected answer (for demo/testing)
    window.__captchaAnswer = function () { return currentText; };

  })();
  </script>
</body>
</html>

      
